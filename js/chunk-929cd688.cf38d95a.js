(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-929cd688"],{"00ee":function(t,e,s){"use strict";var r=s("b622"),a=r("toStringTag"),i={};i[a]="z",t.exports="[object z]"===String(i)},"0210":function(t,e,s){"use strict";var r=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{title:t.title,visible:t.addressForm},on:{"update:visible":function(e){t.addressForm=e},close:t.cancel}},[e("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"姓名",prop:"name"}},[e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),e("el-form-item",{attrs:{label:"手机号",prop:"tel"}},[e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.tel,callback:function(e){t.$set(t.form,"tel",e)},expression:"form.tel"}})],1)],1),e("el-form-item",{attrs:{label:"所在地区",required:""}},[e("el-col",{attrs:{span:23}},[e("el-cascader",{attrs:{size:"large",options:t.options,"show-all-levels":!0},on:{change:t.handleChange},model:{value:t.form.selectedOptions,callback:function(e){t.$set(t.form,"selectedOptions",e)},expression:"form.selectedOptions"}})],1)],1),e("el-form-item",{attrs:{label:"详细地址",prop:"address"}},[e("el-col",{attrs:{span:23}},[e("el-input",{attrs:{type:"textarea"},model:{value:t.form.address,callback:function(e){t.$set(t.form,"address",e)},expression:"form.address"}})],1)],1),e("el-form-item",{attrs:{label:"邮政编号"}},[e("el-col",{attrs:{span:8}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.zipcode,callback:function(e){t.$set(t.form,"zipcode",e)},expression:"form.zipcode"}})],1)],1),e("el-form-item",{attrs:{label:"设为默认",prop:"defaultAddress"}},[e("el-switch",{model:{value:t.form.defaultAddress,callback:function(e){t.$set(t.form,"defaultAddress",e)},expression:"form.defaultAddress"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.cancel}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v(t._s(t.changeBtn))])],1)],1)},a=[],i=(s("d9e2"),s("ef6c")),o={props:{dialogForm:{type:Boolean,required:!0,default:!1},formData:{type:Object,default:()=>{}}},inject:["reload"],watch:{dialogForm:{handler(t){this.addressForm=t},immediate:!0},formData:{handler(t){t&&(this.form=t)},deep:!0}},computed:{title(){return("{}"==JSON.stringify(this.formData)?"添加":"编辑")+"收货地址"},changeBtn(){return"{}"==JSON.stringify(this.formData)?"确 定":"更 改"}},data(){let t=/^1[345789]\d{9}$/,e=(e,s,r)=>{if(!s)return r(new Error("请输入手机号码"));setTimeout(()=>{t.test(s)?r():r(new Error("手机格式有误"))},100)};return{addressForm:!1,options:i["regionData"],form:{name:"",tel:"",selectedOptions:[],region:"",address:"",zipcode:"",defaultAddress:!1},rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,message:"收货人姓名不能小于2个字符",trigger:"blur"}],tel:[{required:!0,validator:e,trigger:"blur"}],address:[{required:!0,message:"街道地址不能为空",trigger:"blur"},{min:5,message:"街道地址不能小于5个字符",trigger:"blur"}]}}},methods:{async save(){this.form.zipcode=this.form.zipcode?this.form.zipcode:"000000","{}"==JSON.stringify(this.formData)?await this.$http.put("/addresses/"+this.form._id,this.form):await this.$http.post("/addresses",this.form),this.$emit("formSave",!1),this.reload()},cancel(){this.formData={},this.$emit("formClose",!1)},handleChange(t){let e="";(t||[]).map(t=>e+=i["CodeToText"][t]),this.form.region=e}}},n=o,c=(s("e69e"),s("2877")),l=Object(c["a"])(n,r,a,!1,null,"e589da9e",null);e["a"]=l.exports},"0cbb":function(t,e,s){"use strict";s("2bb0")},"0d26":function(t,e,s){"use strict";var r=s("e330"),a=Error,i=r("".replace),o=function(t){return String(new a(t).stack)}("zxcasd"),n=/\n\s*at [^:]*:[^\n]*/,c=n.test(o);t.exports=function(t,e){if(c&&"string"==typeof t&&!a.prepareStackTrace)while(e--)t=i(t,n,"");return t}},"10d6":function(t,e,s){},"13d5":function(t,e,s){"use strict";var r=s("23e7"),a=s("d58f").left,i=s("a640"),o=s("2d00"),n=s("605d"),c=!n&&o>79&&o<83,l=c||!i("reduce");r({target:"Array",proto:!0,forced:l},{reduce:function(t){var e=arguments.length;return a(this,t,e,e>1?arguments[1]:void 0)}})},1787:function(t,e,s){"use strict";var r=s("861d");t.exports=function(t){return r(t)||null===t}},1992:function(t,e,s){"use strict";s("6aa5")},"2ba4":function(t,e,s){"use strict";var r=s("40d5"),a=Function.prototype,i=a.apply,o=a.call;t.exports="object"==typeof Reflect&&Reflect.apply||(r?o.bind(i):function(){return o.apply(i,arguments)})},"2bb0":function(t,e,s){},"3bbe":function(t,e,s){"use strict";var r=s("1787"),a=String,i=TypeError;t.exports=function(t){if(r(t))return t;throw new i("Can't set "+a(t)+" as a prototype")}},"3c6d":function(t,e,s){"use strict";s("4ae8")},"4ae8":function(t,e,s){},"577e":function(t,e,s){"use strict";var r=s("f5df"),a=String;t.exports=function(t){if("Symbol"===r(t))throw new TypeError("Cannot convert a Symbol value to a string");return a(t)}},"5e71":function(t,e,s){"use strict";s("edf6")},"605d":function(t,e,s){"use strict";var r=s("da84"),a=s("c6b6");t.exports="process"===a(r.process)},"6aa5":function(t,e,s){},"6f19":function(t,e,s){"use strict";var r=s("9112"),a=s("0d26"),i=s("b980"),o=Error.captureStackTrace;t.exports=function(t,e,s,n){i&&(o?o(t,e):r(t,"stack",a(s,n)))}},7156:function(t,e,s){"use strict";var r=s("1626"),a=s("861d"),i=s("d2bb");t.exports=function(t,e,s){var o,n;return i&&r(o=e.constructor)&&o!==s&&a(n=o.prototype)&&n!==s.prototype&&i(t,n),t}},7282:function(t,e,s){"use strict";var r=s("e330"),a=s("59ed");t.exports=function(t,e,s){try{return r(a(Object.getOwnPropertyDescriptor(t,e)[s]))}catch(i){}}},"805f":function(t,e,s){t.exports=s.p+"img/s-logo.8293060c.webp"},"9d08":function(t,e,s){},a640:function(t,e,s){"use strict";var r=s("d039");t.exports=function(t,e){var s=[][t];return!!s&&r((function(){s.call(null,e||function(){return 1},1)}))}},ab36:function(t,e,s){"use strict";var r=s("861d"),a=s("9112");t.exports=function(t,e){r(e)&&"cause"in e&&a(t,"cause",e.cause)}},aeb0:function(t,e,s){"use strict";var r=s("9bf2").f;t.exports=function(t,e,s){s in t||r(t,s,{configurable:!0,get:function(){return e[s]},set:function(t){e[s]=t}})}},b980:function(t,e,s){"use strict";var r=s("d039"),a=s("5c6c");t.exports=!r((function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",a(1,7)),7!==t.stack)}))},c578:function(t,e,s){"use strict";s("9d08")},d2bb:function(t,e,s){"use strict";var r=s("7282"),a=s("861d"),i=s("1d80"),o=s("3bbe");t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,s={};try{t=r(Object.prototype,"__proto__","set"),t(s,[]),e=s instanceof Array}catch(n){}return function(s,r){return i(s),o(r),a(s)?(e?t(s,r):s.__proto__=r,s):s}}():void 0)},d58f:function(t,e,s){"use strict";var r=s("59ed"),a=s("7b0b"),i=s("44ad"),o=s("07fa"),n=TypeError,c="Reduce of empty array with no initial value",l=function(t){return function(e,s,l,d){var u=a(e),f=i(u),p=o(u);if(r(s),0===p&&l<2)throw new n(c);var m=t?p-1:0,h=t?-1:1;if(l<2)while(1){if(m in f){d=f[m],m+=h;break}if(m+=h,t?m<0:p<=m)throw new n(c)}for(;t?m>=0:p>m;m+=h)m in f&&(d=s(d,f[m],m,u));return d}};t.exports={left:l(!1),right:l(!0)}},d9e2:function(t,e,s){"use strict";var r=s("23e7"),a=s("da84"),i=s("2ba4"),o=s("e5cb"),n="WebAssembly",c=a[n],l=7!==new Error("e",{cause:7}).cause,d=function(t,e){var s={};s[t]=o(t,e,l),r({global:!0,constructor:!0,arity:1,forced:l},s)},u=function(t,e){if(c&&c[t]){var s={};s[t]=o(n+"."+t,e,l),r({target:n,stat:!0,constructor:!0,arity:1,forced:l},s)}};d("Error",(function(t){return function(e){return i(t,this,arguments)}})),d("EvalError",(function(t){return function(e){return i(t,this,arguments)}})),d("RangeError",(function(t){return function(e){return i(t,this,arguments)}})),d("ReferenceError",(function(t){return function(e){return i(t,this,arguments)}})),d("SyntaxError",(function(t){return function(e){return i(t,this,arguments)}})),d("TypeError",(function(t){return function(e){return i(t,this,arguments)}})),d("URIError",(function(t){return function(e){return i(t,this,arguments)}})),u("CompileError",(function(t){return function(e){return i(t,this,arguments)}})),u("LinkError",(function(t){return function(e){return i(t,this,arguments)}})),u("RuntimeError",(function(t){return function(e){return i(t,this,arguments)}}))},e391:function(t,e,s){"use strict";var r=s("577e");t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:r(t)}},e5cb:function(t,e,s){"use strict";var r=s("d066"),a=s("1a2d"),i=s("9112"),o=s("3a9b"),n=s("d2bb"),c=s("e893"),l=s("aeb0"),d=s("7156"),u=s("e391"),f=s("ab36"),p=s("6f19"),m=s("83ab"),h=s("c430");t.exports=function(t,e,s,g){var v="stackTraceLimit",b=g?2:1,_=t.split("."),w=_[_.length-1],y=r.apply(null,_);if(y){var C=y.prototype;if(!h&&a(C,"cause")&&delete C.cause,!s)return y;var x=r("Error"),k=e((function(t,e){var s=u(g?e:t,void 0),r=g?new y(t):new y;return void 0!==s&&i(r,"message",s),p(r,k,r.stack,2),this&&o(C,this)&&d(r,this,k),arguments.length>b&&f(r,arguments[b]),r}));if(k.prototype=C,"Error"!==w?n?n(k,x):c(k,x,{name:!0}):m&&v in y&&(l(k,y,v),l(k,y,"prepareStackTrace")),c(k,y),!h)try{C.name!==w&&i(C,"name",w),C.constructor=k}catch(A){}return k}}},e69e:function(t,e,s){"use strict";s("10d6")},edf6:function(t,e,s){},f0e9:function(t,e,s){"use strict";s.r(e);var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"settlement-page container"},[e("page-header"),e("page-container"),e("page-footer")],1)},a=[],i=function(){var t=this,e=t._self._c;return e("section",{staticClass:"page-header clearfix"},[e("div",{staticClass:"fl page-logo"},[e("router-link",{attrs:{to:"/home"}},[e("img",{attrs:{src:s("805f")}})])],1),e("el-steps",{staticClass:"fr settlement-step",attrs:{active:1,"finish-status":"success","align-center":""}},[e("el-step",{attrs:{title:"我的购物车"}}),e("el-step",{attrs:{title:"填写核对订单信息"}}),e("el-step",{attrs:{title:"成功提交订单"}})],1)],1)},o=[],n=(s("c578"),s("2877")),c={},l=Object(n["a"])(c,i,o,!1,null,"da3775e8",null),d=l.exports,u=function(){var t=this,e=t._self._c;return e("section",{staticClass:"page-container"},[e("order-address"),e("div",{staticClass:"hr"}),e("order-info")],1)},f=[],p=function(){var t=this,e=t._self._c;return e("div",{staticClass:"order-address"},[e("div",{staticClass:"header-warpper"},[e("h3",{staticClass:"fl header-title"},[t._v("选择收货地址")]),e("div",{staticClass:"fr extra"},[e("a",{staticClass:"extra-btn",on:{click:t.addAddress}},[t._v("新增收货地址")])])]),e("div",{staticClass:"address-list list-off",style:{height:t.showHeight?t.listHeight:"42px"}},[e("ul",t._l(t.showList,(function(s,r){return e("li",{key:r,staticClass:"addr-item-wrapper clearfix",on:{mouseenter:function(e){return t.enterBlock(e)},mouseleave:function(e){return t.leaveBlock(e)}}},[e("div",{staticClass:"fl addr-item",class:{"item-selected":t.selectedAddr==r},on:{click:function(e){return t.selecteItem(r)}}},[e("span",{attrs:{title:s.name}},[t._v(t._s(s.name))]),e("b",{staticClass:"iconfont icon-jiaobiaoxuanzhong"})]),e("div",{staticClass:"fl addr-detail"},[e("span",{staticClass:"addr-name",attrs:{title:s.name}},[t._v(t._s(s.name))]),e("span",{staticClass:"addr-info",attrs:{title:""+(s.region+" "+s.address)}},[t._v(t._s(s.region+" "+s.address))]),e("span",{staticClass:"addr-tel"},[t._v(t._s(t._f("hideTel")(s.tel)))])]),e("div",{staticClass:"fr op-btns"},[e("a",{staticClass:"extra-btn",on:{click:function(e){return e.stopPropagation(),t.editAddress(s)}}},[t._v("编辑")]),e("a",{staticClass:"extra-btn",on:{click:function(e){return e.stopPropagation(),t.delAddrress(s)}}},[t._v("删除")])])])})),0)]),t.addressList&&t.addressList.length>1?e("div",{staticClass:"addr-switch",on:{click:function(e){return t.showMore(e)}}},[e("span",[t._v("更多地址")]),e("b",{staticClass:"iconfont icon-shousuoxiajiantou"})]):t._e(),t.addressList&&t.addressList.length>1?e("div",{staticClass:"addr-switch hide",on:{click:function(e){return t.closeMore(e)}}},[e("span",[t._v("收起地址")]),e("b",{staticClass:"iconfont icon-shousuoshangjiantou"})]):t._e(),e("address-form",{attrs:{dialogForm:t.dialogFormVisible,formData:t.formData},on:{formSave:function(e){t.dialogFormVisible=!1},formClose:function(e){t.dialogFormVisible=!1}}})],1)},m=[],h=s("0210"),g={components:{AddressForm:h["a"]},inject:["reload"],data(){return{addressList:[],showList:[],showHeight:!1,selectedAddr:0,dialogFormVisible:!1,formData:{}}},computed:{listHeight(){return 42*this.showList.length+"px"}},created(){this.getAddressList()},methods:{selecteItem(t){this.selectedAddr=t,this.$bus.$emit("selectedAddress",this.showList[t])},showMore(t){t.currentTarget.className="addr-switch hide",t.currentTarget.nextElementSibling.className="addr-switch",this.showHeight=!this.showHeight,this.showList=this.addressList},closeMore(t){t.currentTarget.className="addr-switch hide",t.currentTarget.previousElementSibling.className="addr-switch",this.showHeight=!this.showHeight,this.showList=this.addressList.slice(0,1)},enterBlock(t){t.currentTarget.className="addr-item-wrapper clearfix li-hover"},leaveBlock(t){t.currentTarget.className="addr-item-wrapper clearfix"},addAddress(){this.dialogFormVisible=!0,this.formData={}},editAddress(t){this.dialogFormVisible=!0,this.formData=t},delAddrress(t){this.$confirm("确定要删除该收货地址吗?","删除",{confirmButtonText:"确定",cancelButtonClass:"取消",type:"warning"}).then(async()=>{await this.$http.delete("addresses/"+t._id);this.$message({type:"success",message:"删除成功！"}),this.reload()})},async getAddressList(){const t=await this.$http.get("/addresses");this.addressList=(null===t||void 0===t?void 0:t.data)||[],this.showList=this.addressList.slice(0,1),this.$bus.$emit("selectedAddress",this.showList[this.selectedAddr])}}},v=g,b=(s("1992"),Object(n["a"])(v,p,m,!1,null,"218202b0",null)),_=b.exports,w=function(){var t=this,e=t._self._c;return e("div",{staticClass:"order-info"},[t._m(0),e("el-table",{staticStyle:{width:"100%","font-size":"12px"},attrs:{data:t.goodsList,"tooltip-effect":"dark"}},[e("el-table-column",{attrs:{label:"商品"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{staticClass:"content-goods"},[e("div",{staticClass:"goods-img"},[e("img",{attrs:{src:s.row.goodsImageBig,alt:"商品图片"}})]),e("div",{staticClass:"goods-name"},[t._v(t._s(s.row.goodsName))])])]}}])}),e("el-table-column",{attrs:{prop:"",label:"商品属性",width:"220"}}),e("el-table-column",{attrs:{prop:"salePrice",label:"单价",width:"120"}}),e("el-table-column",{attrs:{prop:"goodsNum",label:"数量",width:"120"}}),e("el-table-column",{attrs:{label:"小计",width:"180"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v("¥")]),e("span",{staticClass:"Subtotal"},[t._v(" "+t._s(t._f("keepTwoNum")(s.row.salePrice*s.row.goodsNum))+" ")])]}}])})],1),e("div",{staticClass:"settlement"},[e("div",{staticClass:"account"},[e("span",[t._v("总商品金额：")]),e("span",{staticClass:"account-content"},[t._v(t._s("¥ "+t.sum))])]),e("div",{staticClass:"account"},[e("span",[t._v("运费：")]),e("span",{staticClass:"account-content"},[t._v(t._s("¥ 0.00"))])])])],1)},y=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"header-warpper"},[e("h3",{staticClass:"header-title"},[t._v("确认订单信息")])])}],C=(s("13d5"),{computed:{sum(){var t;let e=null===(t=this.goodsList)||void 0===t?void 0:t.reduce((t,e)=>t+e.goodsNum*parseFloat(e.salePrice),0);e=String(e.toFixed(2));let s={amount:e,goodsList:this.goodsList};return this.$bus.$emit("sum",s),e}},data(){return{goodsList:[]}},mounted(){this.goodsList=JSON.parse(this.$route.query.goodsList)}}),x=C,k=(s("3c6d"),Object(n["a"])(x,w,y,!1,null,"2426b4aa",null)),A=k.exports,$={components:{OrderAddress:_,OrderInfo:A}},L=$,O=(s("5e71"),Object(n["a"])(L,u,f,!1,null,"36ea624a",null)),S=O.exports,T=function(){var t=this,e=t._self._c;return e("section",{staticClass:"page-footer clearfix"},[e("div",{staticClass:"trade-footer"},[e("div",{staticClass:"price-info"},[e("span",{staticClass:"price-tit"},[t._v("应付总额：")]),e("span",{staticClass:"price-num"},[t._v("¥"+t._s(t._f("keepTwoNum")(t.sum)))])]),e("div",{staticClass:"address-info"},[e("span",{staticClass:"sendAddr"},[t._v(t._s(t.receiveAddress))]),e("span",{staticClass:"sendMobile"},[t._v(t._s(t._f("hideTel")(t.receivePerson)))])])]),e("div",{staticClass:"trade-btn"},[e("el-button",{attrs:{type:"primary"},on:{click:t.toPayment}},[t._v("提交订单")])],1)])},E=[],j=(s("14d9"),s("2f62")),N={data(){return{addressItem:{},sum:"",goods:[]}},computed:{...Object(j["c"])(["login"]),receiveAddress(){return"寄送至："+(this.addressItem.region+" "+this.addressItem.address)},receivePerson(){return"收货人："+(this.addressItem.name+" "+this.addressItem.tel)}},mounted(){this.$bus.$on("selectedAddress",t=>{this.addressItem=t}),this.$bus.$on("sum",t=>{this.sum=t.amount,this.goods=t.goodsList})},methods:{async toPayment(){if(this.login){let t={goods:this.goods,address:this.addressItem._id};const e=await this.$http.post("/order",t);let s=e.data.outTradeNo;this.$router.push({path:"/payment",query:{orderId:s,total:this.sum,goods:JSON.stringify(this.goods)}})}else this.$dialog.confirm({title:"温馨提示",message:"您还未登录或者登录状态失效，请登录后再来操作"}).then(()=>{this.$router.push("login")})}}},F=N,P=(s("0cbb"),Object(n["a"])(F,T,E,!1,null,"61b54d28",null)),z=P.exports,D={components:{PageHeader:d,PageContainer:S,PageFooter:z}},I=D,B=Object(n["a"])(I,r,a,!1,null,null,null);e["default"]=B.exports},f5df:function(t,e,s){"use strict";var r=s("00ee"),a=s("1626"),i=s("c6b6"),o=s("b622"),n=o("toStringTag"),c=Object,l="Arguments"===i(function(){return arguments}()),d=function(t,e){try{return t[e]}catch(s){}};t.exports=r?i:function(t){var e,s,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(s=d(e=c(t),n))?s:l?i(e):"Object"===(r=i(e))&&a(e.callee)?"Arguments":r}}}]);
//# sourceMappingURL=chunk-929cd688.cf38d95a.js.map